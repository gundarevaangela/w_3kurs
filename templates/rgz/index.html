{% extends "rgz/base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto; padding: 20px;">
    <h1 style="color: #d63384;">Инициативы</h1>
    
    {% if current_user.is_authenticated %}
        <a href="{{ url_for('rgz.create') }}" style="display: inline-block; margin-bottom: 20px; padding: 10px 15px; background: #ff66b2; color: white; text-decoration: none; border-radius: 5px;">
            + Новая инициатива
        </a>
    {% else %}
        <p style="color: #8a2d5e; margin-bottom: 20px;">
            <a href="/lab8/register/" style="color: #d63384; text-decoration: underline;">
                Зарегистрируйтесь
            </a> или 
            <a href="/lab8/login" style="color: #d63384; text-decoration: underline;">
                войдите
            </a>, чтобы создавать инициативы и голосовать.
        </p>
    {% endif %}
    
    {% for initiative in initiatives.items %}
        <div style="background: white; border: 1px solid #ffccdd; border-radius: 5px; padding: 15px; margin-bottom: 15px;">
            <h3 style="margin-top: 0; color: #d63384;">{{ initiative.title }}</h3>
            <p style="color: #8a2d5e;">
                {{ initiative.content[:200] }}{% if initiative.content|length > 200 %}...{% endif %}
            </p>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                <div style="color: #cc6699; font-size: 0.9em;">
                    {{ initiative.created_at.strftime('%d.%m.%Y %H:%M') }}
                    | Оценка: 
                    <span style="color: {% if initiative.score >= 0 %}#d63384{% else %}#ff6666{% endif %}; font-weight: bold;">
                        {{ initiative.score }}
                    </span>
                </div>
                
                <a href="{{ url_for('rgz.view_initiative', id=initiative.id) }}" style="padding: 5px 10px; background: #ff99cc; color: white; text-decoration: none; border-radius: 3px;">
                    Подробнее
                </a>
            </div>
        </div>
    {% else %}
        <p style="color: #8a2d5e; text-align: center; margin: 40px 0;">
            Инициатив пока нет. 
            <a href="/lab8/register/" style="color: #d63384; text-decoration: underline;">
                Зарегистрируйтесь
            </a>, чтобы создать первую!
        </p>
    {% endfor %}
    
    <!-- Пагинация -->
    {% if initiatives.pages > 1 %}
        <div style="text-align: center; margin-top: 30px;">
            {% if initiatives.has_prev %}
                <a href="{{ url_for('rgz.main', page=initiatives.prev_num) }}" style="margin: 0 5px; padding: 5px 10px; border: 1px solid #ff99cc; color: #d63384; text-decoration: none;">
                    ← Назад
                </a>
            {% endif %}
            
            {% for page_num in initiatives.iter_pages(left_edge=2, right_edge=2, left_current=1, right_current=2) %}
                {% if page_num %}
                    <a href="{{ url_for('rgz.main', page=page_num) }}" 
                       style="margin: 0 3px; padding: 5px 10px; 
                              {% if page_num == initiatives.page %}background: #ff66b2; color: white; border: 1px solid #ff66b2;{% else %}border: 1px solid #ff99cc; color: #d63384;{% endif %}
                              text-decoration: none;">
                        {{ page_num }}
                    </a>
                {% endif %}
            {% endfor %}
            
            {% if initiatives.has_next %}
                <a href="{{ url_for('rgz.main', page=initiatives.next_num) }}" style="margin: 0 5px; padding: 5px 10px; border: 1px solid #ff99cc; color: #d63384; text-decoration: none;">
                    Вперед →
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}