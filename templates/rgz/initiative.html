{% extends "rgz/base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto; padding: 20px;">
    <a href="{{ url_for('rgz.main') }}" style="display: inline-block; margin-bottom: 15px; color: #d63384; text-decoration: none;">
        ← Назад к списку
    </a>
    
    <div style="background: white; border: 2px solid #ffccdd; border-radius: 10px; padding: 25px;">
        <h1 style="margin-top: 0; color: #d63384;">{{ initiative.title }}</h1>
        
        <p style="color: #8a2d5e; margin-bottom: 20px;">
            Автор: <span style="color: #d63384; font-weight: 500;">{{ initiative.author.login }}</span> | 
            {{ initiative.created_at.strftime('%d.%m.%Y %H:%M') }}
        </p>
        
        <div style="white-space: pre-line; margin-bottom: 30px; line-height: 1.6; color: #6d2a4f; 
             background: #fff9fb; padding: 20px; border-radius: 8px; border: 1px solid #ffccdd;">
            {{ initiative.content }}
        </div>
        
        <hr style="border: none; height: 1px; background: #ffccdd; margin: 25px 0;">
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
            <div>
                <h3 style="margin: 0; color: #d63384;">
                    Оценка: 
                    <span style="color: {% if score >= 0 %}#d63384{% else %}#ff6666{% endif %};">
                        {{ score }}
                    </span>
                </h3>
                <small style="color: #cc6699;">
                    За: {{ upvotes }} | Против: {{ downvotes }}
                </small>
            </div>
            
            {% if current_user.is_authenticated and current_user.id != initiative.user_id %}
                <div>
                    <form method="POST" action="{{ url_for('rgz.vote', id=initiative.id) }}" style="display: inline;">
                        <input type="hidden" name="vote_type" value="up">
                        <button type="submit" style="padding: 8px 15px; 
                                background: {% if user_vote == 'up' %}#ff66b2{% else %}white{% endif %}; 
                                color: {% if user_vote == 'up' %}white{% else %}#ff66b2{% endif %}; 
                                border: 2px solid #ff66b2; border-radius: 5px; cursor: pointer; font-weight: 500;">
                            За
                        </button>
                    </form>
                    
                    <form method="POST" action="{{ url_for('rgz.vote', id=initiative.id) }}" style="display: inline; margin-left: 10px;">
                        <input type="hidden" name="vote_type" value="down">
                        <button type="submit" style="padding: 8px 15px; 
                                background: {% if user_vote == 'down' %}#ff6666{% else %}white{% endif %}; 
                                color: {% if user_vote == 'down' %}white{% else %}#ff6666{% endif %}; 
                                border: 2px solid #ff6666; border-radius: 5px; cursor: pointer; font-weight: 500;">
                            Против
                        </button>
                    </form>
                </div>
            {% elif current_user.is_authenticated %}
                <p style="color: #cc6699; margin: 0; padding: 8px 12px; background: #fff9fb; border-radius: 5px; border: 1px solid #ffccdd;">
                    Вы не можете голосовать за свою инициативу
                </p>
            {% else %}
                <p style="color: #cc6699; margin: 0;">
                    <a href="/lab8/login" style="color: #d63384; text-decoration: underline; font-weight: 500;">
                        Войдите
                    </a>, чтобы проголосовать
                </p>
            {% endif %}
        </div>
        
        <hr style="border: none; height: 1px; background: #ffccdd; margin: 25px 0;">
        
        <div style="margin-top: 20px;">
            {% if current_user.id == initiative.user_id %}
                <form method="POST" action="{{ url_for('rgz.delete_initiative', id=initiative.id) }}" 
                      onsubmit="return confirm('Удалить свою инициативу?')"
                      style="display: inline;">
                    <button type="submit" style="padding: 8px 15px; 
                            background: #ff6666; color: white; border: none; border-radius: 5px; 
                            cursor: pointer; font-weight: 500;">
                        Удалить свою инициативу
                    </button>
                </form>
            {% endif %}
            
            {% if current_user.is_admin %}
                <form method="POST" action="{{ url_for('rgz.admin_delete_initiative', id=initiative.id) }}" 
                      onsubmit="return confirm('Удалить инициативу как администратор?')"
                      style="display: inline; margin-left: 10px;">
                    <button type="submit" style="padding: 8px 15px; 
                            background: #ffcc66; color: #8a2d5e; border: none; border-radius: 5px; 
                            cursor: pointer; font-weight: 500;">
                        Удалить (админ)
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}